<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="true"><meta name="msvalidate.01" content="true"><meta name="baidu-site-verification" content="true"><link rel="alternate" type="application/rss+xml" title="forget-me-not" href="https://maikire.xyz/rss.xml"><link rel="alternate" type="application/atom+xml" title="forget-me-not" href="https://maikire.xyz/atom.xml"><link rel="alternate" type="application/json" title="forget-me-not" href="https://maikire.xyz/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Lua"><link rel="canonical" href="https://maikire.xyz/2025/01/20/Lua/Lua/"><title>Lua - Lua | Starry Letter = forget-me-not</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Lua</h1><div class="meta"><span class="item" title="创建时间：2025-01-20 12:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2025-01-20T12:00:00+08:00">2025-01-20</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>20k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>18 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Starry Letter</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://img.z4a.net/images/2025/08/01/2022-03-07-183912.jpeg"></li><li class="item" data-background-image="https://img.z4a.net/images/2025/08/01/2023-02-20-161022.jpeg"></li><li class="item" data-background-image="https://img.z4a.net/images/2025/07/31/cg20.jpeg"></li><li class="item" data-background-image="https://img.z4a.net/images/2025/08/01/3346786c271f3b3a1bf86666c2e38a04daa8e2eba634bcc.jpeg"></li><li class="item" data-background-image="https://img.z4a.net/images/2025/08/01/null-3850ac89830f01c2.jpeg"></li><li class="item" data-background-image="https://img.z4a.net/images/2025/07/31/cg23.jpeg"></li></ul></div><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div></header><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Lua/" itemprop="item" rel="index" title="分类于 Lua"><span itemprop="name">Lua</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://maikire.xyz/2025/01/20/Lua/Lua/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Maikire"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="forget-me-not"></span><div class="body md" itemprop="articleBody"><h1 id="lua"><a class="anchor" href="#lua">#</a> Lua</h1><p>Lua 是一种轻量的脚本语言，用标准 C 语言编写并且开源<br>Lua 常用于游戏开发、应用脚本、应用插件等</p><p>Lua 可以很方便的嵌入别的程序里，可以直接使用宿主语言（通常是 C 或 C++）提供的功能<br>Lua 支持面向过程编程、自动内存管理、语言内置模式匹配、闭包（通过闭包和 table 可以支持面向对象编程）、多线程</p><p>Lua 代码文件的后缀名为 .lua</p><p>建议：VS Code 中有很多关于 Lua 的扩展，可以方便编程和调试</p><h1 id="基本语法"><a class="anchor" href="#基本语法">#</a> 基本语法</h1><h2 id="注释"><a class="anchor" href="#注释">#</a> 注释</h2><p>单行注释：使用 -- 开头</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">--print("Hello World")</span></pre></td></tr></table></figure><p>多行注释：使用 --[[开始，使用]] 结束，为了美观，也可以使用 --]] 结束<br>注意：Lua 不支持嵌套注释</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">--[[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>print("Hello World")</pre></td></tr><tr><td data-num="3"></td><td><pre>print("Hello World")</pre></td></tr><tr><td data-num="4"></td><td><pre>--]]</pre></td></tr></table></figure><h2 id="标识符"><a class="anchor" href="#标识符">#</a> 标识符</h2><ul><li>标识符用于定义一个变量、函数等，命名规则和 C 语言差不多</li><li>Lua 保留的关键词较少，其中有很多都和 C 语言一样</li><li>以下划线开头连接一串大写字母的名字（比如 _VERSION）被保留用于 Lua 内部全局变量</li></ul><h2 id="数据类型"><a class="anchor" href="#数据类型">#</a> 数据类型</h2><p>Lua 变量会自动分配数据类型，只需要为变量赋值即可</p><table><thead><tr><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>nil</td><td>表示一个无效值。在条件表达式中表示 false</td></tr><tr><td>boolean</td><td>true 或 false</td></tr><tr><td>number</td><td>双精度点数</td></tr><tr><td>string</td><td>字符串</td></tr><tr><td>function</td><td>由 C 或 Lua 声明的函数</td></tr><tr><td>userdata</td><td>存储在变量中的 C 语言数据结构</td></tr><tr><td>thread</td><td>独立线程</td></tr><tr><td>table</td><td>关联数组，编号从 1 开始</td></tr></tbody></table><h2 id="变量"><a class="anchor" href="#变量">#</a> 变量</h2><ul><li>Lua 变量有三种类型：全局变量、局部变量、表中的域</li><li>变量的默认值均为 nil，访问一个没有初始化的变量不会出错，得到的结果为 nil</li><li>Lua 中的变量全是全局变量，在函数里声明的也是全局变量，除非用 local 显式声明为局部变量</li><li>变量在使用前需要先赋值，给一个变量赋值后就表明创建了一个全局变量</li><li>删除一个全局变量，只需要将变量赋值为 nil</li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>a <span class="token operator">=</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>a<span class="token operator">=</span><span class="token keyword">nil</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">--[[</span></pre></td></tr><tr><td data-num="7"></td><td><pre>运行结果</pre></td></tr><tr><td data-num="8"></td><td><pre>nil</pre></td></tr><tr><td data-num="9"></td><td><pre>10</pre></td></tr><tr><td data-num="10"></td><td><pre>--]]</pre></td></tr></table></figure><h2 id="循环和条件"><a class="anchor" href="#循环和条件">#</a> 循环和条件</h2><p>循环语句</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">--while</span></pre></td></tr><tr><td data-num="2"></td><td><pre>a <span class="token operator">=</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">while</span> <span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    a <span class="token operator">=</span> a <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">--for</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">--for 的三个表达式在循环开始前一次性求值，以后不再进行求值</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">-- a 从 0 开始，增加到 4 (a &lt;= 4)，每次增加的值为 2</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">for</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">-- 泛型 for</span></pre></td></tr><tr><td data-num="16"></td><td><pre>a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"3a"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">--repeat...until 与 C 语言 do...while () 中的 while () 相反</span></pre></td></tr><tr><td data-num="22"></td><td><pre>a <span class="token operator">=</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">repeat</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    a <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">until</span> <span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">-- 嵌套循环</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment">-- 选择排序</span></pre></td></tr><tr><td data-num="30"></td><td><pre>a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    index <span class="token operator">=</span> i</pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">for</span> j <span class="token operator">=</span> i<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">></span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            index <span class="token operator">=</span> j</pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    temp <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>index<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    a<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> temp</pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token comment">-- break 可以跳出循环，与 C 语言一样</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token comment">-- goto 与 C 语言一样，不建议使用</span></pre></td></tr></table></figure><p>条件语句</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><h2 id="运算符"><a class="anchor" href="#运算符">#</a> 运算符</h2><p>这里仅指出与 C 语言不同的部分</p><p>算术运算符</p><ul><li>/ 表示小数的除法</li><li>// 表示取整的除法</li><li>^ 乘幂</li></ul><p>关系运算符</p><ul><li>~= 不等于</li></ul><p>逻辑运算符</p><ul><li>and 逻辑与</li><li>or 逻辑或</li><li>not 逻辑非</li></ul><p>其他</p><ul><li>.. 连接两个字符串</li><li># 返回字符串或表的长度。例如： <code>#&quot;123&quot;</code> 返回 3</li></ul><p>运算符连接</p><ul><li>除了 ^ 和 .. 以外，所有的二元运算符都是左连接的</li></ul><p>运算符优先级</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">--[[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>1. ^</pre></td></tr><tr><td data-num="3"></td><td><pre>2. not   -（负号）</pre></td></tr><tr><td data-num="4"></td><td><pre>3. *   /   %</pre></td></tr><tr><td data-num="5"></td><td><pre>4. +   -（减号）</pre></td></tr><tr><td data-num="6"></td><td><pre>5. ..</pre></td></tr><tr><td data-num="7"></td><td><pre>6. &lt;   >   &lt;=   >=   ~=   ==</pre></td></tr><tr><td data-num="8"></td><td><pre>7. and</pre></td></tr><tr><td data-num="9"></td><td><pre>8. or</pre></td></tr><tr><td data-num="10"></td><td><pre>--]]</pre></td></tr></table></figure><h2 id="字符串"><a class="anchor" href="#字符串">#</a> 字符串</h2><ul><li>使用 ' 或 &quot; 得到的结果完全相同</li><li>可以使用 [[]] 输入多行字符串</li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre>a <span class="token operator">=</span> <span class="token string">"aaa"</span></pre></td></tr><tr><td data-num="2"></td><td><pre>b <span class="token operator">=</span> <span class="token string">'bbb'</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>c <span class="token operator">=</span> <span class="token string">[[</span></pre></td></tr><tr><td data-num="5"></td><td><pre>a</pre></td></tr><tr><td data-num="6"></td><td><pre>b</pre></td></tr><tr><td data-num="7"></td><td><pre>c</pre></td></tr><tr><td data-num="8"></td><td><pre>]]</pre></td></tr></table></figure><table><thead><tr><th>常用函数</th><th>功能描述</th></tr></thead><tbody><tr><td><code>string.byte(s [, i [, j]])</code></td><td>返回字符串中第 <code>i</code> 到 <code>j</code> 个字符的 ASCII 值，默认返回第一个字符的 ASCII 值</td></tr><tr><td><code>string.char(...)</code></td><td>接收一系列整数，返回这些整数对应的字符组成的字符串</td></tr><tr><td><code>string.find(s, pattern [, init [, plain]])</code></td><td>在字符串 <code>s</code> 中查找符合 <code>pattern</code> 的模式，返回匹配的起止位置及匹配内容</td></tr><tr><td><code>string.format(formatstring, ...)</code></td><td>返回一个格式化后的字符串，类似于 C 语言中的 <code>printf</code></td></tr><tr><td><code>string.gmatch(s, pattern)</code></td><td>返回一个迭代器，用于遍历字符串 <code>s</code> 中所有匹配 <code>pattern</code> 的子串</td></tr><tr><td><code>string.gsub(s, pattern, repl [, n])</code></td><td>将字符串 <code>s</code> 中的 <code>pattern</code> 替换为 <code>repl</code> ，最多替换 <code>n</code> 次</td></tr><tr><td><code>string.len(s)</code></td><td>返回字符串 <code>s</code> 的长度</td></tr><tr><td><code>string.lower(s)</code></td><td>将字符串 <code>s</code> 转换为小写形式</td></tr><tr><td><code>string.match(s, pattern [, init])</code></td><td>在字符串 <code>s</code> 中匹配 <code>pattern</code> ，返回第一个匹配的子串</td></tr><tr><td><code>string.rep(s, n [, sep])</code></td><td>将字符串 <code>s</code> 重复 <code>n</code> 次，可以选择性地添加分隔符 <code>sep</code></td></tr><tr><td><code>string.reverse(s)</code></td><td>返回字符串 <code>s</code> 的反转版本</td></tr><tr><td><code>string.sub(s, i [, j])</code></td><td>返回字符串 <code>s</code> 从第 <code>i</code> 到第 <code>j</code> 个字符的子串</td></tr><tr><td><code>string.upper(s)</code></td><td>将字符串 <code>s</code> 转换为大写形式</td></tr></tbody></table><p>模式匹配</p><ul><li>与 正则表达式 不同，Lua 提供了一个轻量级的匹配机制</li><li>如果需要更复杂的正则表达式功能，可以通过 Lua 的扩展库（例如：<span class="exturl" data-url="aHR0cDovL3d3dy5pbmYucHVjLXJpby5ici9+cm9iZXJ0by9scGVnLw==">LPeg</span>）来实现。LPeg 是一个功能强大的模式匹配库，支持完整的正则表达式功能和更多自定义模式</li></ul><table><thead><tr><th>符号</th><th>描述</th></tr></thead><tbody><tr><td><code>.</code></td><td>匹配任意单个字符（除了换行符）。</td></tr><tr><td><code>%a</code></td><td>匹配任意字母（大小写皆可）。</td></tr><tr><td><code>%d</code></td><td>匹配任意数字。</td></tr><tr><td><code>%s</code></td><td>匹配空白字符（空格、制表符等）。</td></tr><tr><td><code>%w</code></td><td>匹配字母和数字。</td></tr><tr><td><code>%p</code></td><td>匹配标点符号。</td></tr><tr><td><code>%x</code></td><td>匹配十六进制数字。</td></tr><tr><td><code>*</code></td><td>匹配前面的模式零次或多次（贪婪匹配）。</td></tr><tr><td><code>+</code></td><td>匹配前面的模式一次或多次（贪婪匹配）。</td></tr><tr><td><code>-</code></td><td>匹配前面的模式零次或多次（非贪婪匹配）。</td></tr><tr><td><code>?</code></td><td>匹配前面的模式零次或一次。</td></tr><tr><td><code>^</code></td><td>匹配字符串的开头。</td></tr><tr><td><code>$</code></td><td>匹配字符串的结尾。</td></tr><tr><td><code>%bxy</code></td><td>匹配成对的字符 <code>x</code> 和 <code>y</code> （如 <code>%b()</code> 匹配括号中的内容）。</td></tr><tr><td><code>()</code></td><td>捕获模式，返回匹配到的子串</td></tr></tbody></table><p>示例</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 查找数字</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">local</span> s <span class="token operator">=</span> <span class="token string">"Lua 2025!"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">local</span> num <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"%d+"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token comment">-- 输出：2025</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">-- 捕获子串</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">-- 一个括号就是一个子模式，子模式如果匹配成功就会被记录下来，按照先后顺序依次编号</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">local</span> s <span class="token operator">=</span> <span class="token string">"Hello Lua!"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">local</span> word <span class="token operator">=</span> <span class="token punctuation">&#123;</span>string<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"(%a+)%s(%a+)"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>word<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- 输出一号捕获物 Hello</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>word<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- 输出二号捕获物 Lua</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">-- 替换字符串</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">local</span> s <span class="token operator">=</span> <span class="token string">"abc123abc"</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">local</span> new_s <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">gsub</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"%d+"</span><span class="token punctuation">,</span> <span class="token string">"456"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>new_s<span class="token punctuation">)</span> <span class="token comment">-- 输出：abc456abc</span></pre></td></tr></table></figure><h2 id="table"><a class="anchor" href="#table">#</a> table</h2><ul><li>除了 nil 以外，可以将任意类型的值放入 table 中</li><li>同一个 table 可以存入多个不同类型的值</li><li>Lua 中没有数组类型，而是使用 table 代替</li><li>Lua 通过 table 来解决模块（module）、包（package）、对象（Object）</li><li>动态大小</li><li>引用类型</li><li>浅拷贝</li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 键值对</span></pre></td></tr><tr><td data-num="2"></td><td><pre>t <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span></pre></td></tr><tr><td data-num="4"></td><td><pre>t<span class="token punctuation">[</span><span class="token string">"wow"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"wow"</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">-- 字典</span></pre></td></tr><tr><td data-num="7"></td><td><pre>dic <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    name <span class="token operator">=</span> <span class="token string">"Lua"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    version <span class="token operator">=</span> <span class="token string">"5.4"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    is_dynamic <span class="token operator">=</span> <span class="token keyword">true</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>dic<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>dic<span class="token punctuation">[</span><span class="token string">"version"</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">-- 数组</span></pre></td></tr><tr><td data-num="17"></td><td><pre>array <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">-- 嵌套（多维数组）</span></pre></td></tr><tr><td data-num="20"></td><td><pre>a <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>常用函数举例</p><table><thead><tr><th>常用函数</th><th>描述</th></tr></thead><tbody><tr><td><code>table.insert</code></td><td>在指定位置插入一个元素。如果未指定位置，则在表的末尾插入</td></tr><tr><td><code>table.remove</code></td><td>删除指定位置的元素，并返回被删除的值。如果未指定位置，则删除最后一个元素</td></tr><tr><td><code>table.concat</code></td><td>将数组中的元素连接成一个字符串，可指定分隔符</td></tr><tr><td><code>table.sort</code></td><td>对数组进行排序，可以指定自定义排序函数</td></tr><tr><td><code>table.pack</code></td><td>将任意数量的值打包为一个 table，同时添加一个 <code>n</code> 字段表示元素数量</td></tr><tr><td><code>table.unpack</code></td><td>将数组解包为单独的返回值</td></tr><tr><td><code>table.move</code></td><td>将元素从一个表的指定范围移动到目标表的指定位置</td></tr><tr><td><code>table.clear</code></td><td>清空表中的所有键值对</td></tr></tbody></table><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- table.insert</span></pre></td></tr><tr><td data-num="2"></td><td><pre>t <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>       <span class="token comment">-- 插入到末尾</span></pre></td></tr><tr><td data-num="4"></td><td><pre>table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token comment">-- 插入到索引 1</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">-- table.concat</span></pre></td></tr><tr><td data-num="7"></td><td><pre>t <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Lua"</span><span class="token punctuation">,</span> <span class="token string">"is"</span><span class="token punctuation">,</span> <span class="token string">"awesome"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出: Lua is awesome</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">-- table.move</span></pre></td></tr><tr><td data-num="11"></td><td><pre>t1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>t2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>table<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> t2<span class="token punctuation">)</span> <span class="token comment">-- 将 t1 的索引 2-4 的元素移动到 t2</span></pre></td></tr></table></figure><h2 id="函数"><a class="anchor" href="#函数">#</a> 函数</h2><p>Lua 函数的定义</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre>optional_function_scope <span class="token keyword">function</span> <span class="token function">function_name</span><span class="token punctuation">(</span> argument1<span class="token punctuation">,</span> argument2<span class="token punctuation">,</span> argument3<span class="token punctuation">...</span><span class="token punctuation">,</span> argumentn<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    function_body</pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> result_params_comma_separated</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><ul><li>optional_function_scope：该参数是可选的指定函数是全局函数还是局部函数，未设置该参数默认为全局函数，如果你需要设置函数为局部函数需要使用关键字 local</li><li>function_name：指定函数名称</li><li>argument1, argument2, argument3..., argumentn：函数参数。这里的参数全都是形参（也就是局部变量）</li><li>function_body：函数体，函数中需要执行的代码语句块</li><li>result_params_comma_separated：函数返回值，Lua 语言函数可以返回多个值，每个值以逗号隔开</li></ul><p>举例</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 函数必须声明后才能调用</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">-- a 是固定参数，必须赋值</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">-- ... 是可变数量的参数</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">local</span> b <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">local</span> list <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">...</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">local</span> sum <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token function">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        sum <span class="token operator">=</span> sum <span class="token operator">+</span> v</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    sum <span class="token operator">=</span> sum <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"b = "</span> <span class="token operator">..</span> b<span class="token punctuation">)</span> <span class="token comment">-- .. 用于连接两个字符串</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"sum = "</span> <span class="token operator">..</span> sum<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token function">Test</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="闭包"><a class="anchor" href="#闭包">#</a> 闭包</h2><p>闭包（Closure）是指 一个函数以及它所引用的词法作用域中的变量的组合。闭包允许函数在定义时捕获并保留其外部环境中的状态，哪怕这个环境已经不再存在。</p><p>闭包的特点</p><ul><li>函数嵌套</li><li>内部函数会捕获并保留外部函数的局部变量</li><li>闭包可以记住它捕获的变量状态</li></ul><p>闭包的用途</p><ul><li>数据封装<ul><li>使用闭包隐藏变量，使其只对特定函数可见</li><li>类似于类的私有成员变量</li></ul></li><li>回调和事件监听<ul><li>在事件驱动编程中，闭包可以用来保存上下文状态</li></ul></li><li>高阶函数<ul><li>通过闭包实现函数式编程的特性，如偏函数应用、柯里化等</li></ul></li><li>模拟对象<ul><li>在没有面向对象支持的语言中，闭包可以用来模拟对象的行为</li></ul></li></ul><p>举例</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">create_counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">local</span> count <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">-- 外部函数的局部变量</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- 返回一个匿名函数</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">-- 捕获并修改外部变量 count</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> count</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">-- 创建一个计数器闭包</span></pre></td></tr><tr><td data-num="11"></td><td><pre>counter <span class="token operator">=</span> <span class="token function">create_counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">-- 调用闭包函数</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出 1</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出 2</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出 3</span></pre></td></tr></table></figure><p>闭包的内存管理</p><ul><li>闭包捕获的变量会被保存在堆内存中，只要闭包仍然被引用，这些变量就不会被垃圾回收。如果闭包不再被使用，捕获的变量会被回收</li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 闭包的生命周期</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">create_closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">local</span> x <span class="token operator">=</span> <span class="token number">42</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> x</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">local</span> closure <span class="token operator">=</span> <span class="token function">create_closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">-- 输出 42</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>closure <span class="token operator">=</span> <span class="token keyword">nil</span>  <span class="token comment">-- 闭包不再引用，x 被垃圾回收</span></pre></td></tr></table></figure><h2 id="迭代器"><a class="anchor" href="#迭代器">#</a> 迭代器</h2><p>泛型 for</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- ipairs () 是 Lua 默认提供的迭代函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">-- k 是索引，v 是值，全都是局部变量</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">-- body</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><p>执行过程</p><ol><li>初始化，计算 in 后面表达式的值，表达式应该返回泛型 for 需要的三个值：迭代函数、状态常量、控制变量。与多值赋值一样，如果表达式返回的结果个数不足三个会自动用 nil 补足，多出部分会被忽略</li><li>将状态常量和控制变量作为参数调用迭代函数（注意：状态常量储存的是引用）</li><li>将迭代函数返回的值赋给变量列表</li><li>如果返回的第一个值为 nil 循环结束，否则执行循环体</li><li>回到第二步再次调用迭代函数</li></ol><p>Lua 迭代器</p><ul><li>无状态的迭代器<ul><li>不保留任何状态的迭代器</li><li>例如：ipairs ()，它遍历数组的每一个元素，元素的索引需要是数值</li></ul></li><li>多状态的迭代器<ul><li>迭代器需要保存多个状态信息</li><li>使用 闭包 或者将信息封装到 table 中</li></ul></li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 无状态的迭代器</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">-- 自定义 ipairs ()</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">function</span> <span class="token function">iter</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">local</span> v <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> v <span class="token keyword">then</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> i<span class="token punctuation">,</span> v</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">function</span> <span class="token function">my_ipairs</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">-- 迭代函数 iter, 状态常量 a, 控制变量的初始值 0</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">-- 这些值将被 for 循环用于控制迭代</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">return</span> iter<span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>array <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">-- iter 的两个返回值分别赋值给了 i 和 v</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">-- 从第二次开始，每次迭代只会调用函数 iter</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">-- 状态常量 a 引用了 array 的内存地址</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">-- 之后的迭代过程中，即使 array 发生改变，也不会影响迭代结果</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">my_ipairs</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        array <span class="token operator">=</span> <span class="token keyword">nil</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 多状态的迭代器</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">-- 计算斐波那契数列</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">function</span> <span class="token function">fibonacci_iterator</span><span class="token punctuation">(</span>max_count<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">local</span> count <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">-- 控制变量：记录当前是第几个斐波那契数</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">local</span> prev<span class="token punctuation">,</span> curr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">-- 状态变量：两个数用于计算下一个斐波那契数</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">-- 定义迭代器函数</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">if</span> count <span class="token operator">>=</span> max_count <span class="token keyword">then</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">nil</span> <span class="token comment">-- 当达到最大次数时结束迭代</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>        count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">-- 更新控制变量</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">local</span> next_value <span class="token operator">=</span> prev <span class="token operator">+</span> curr</pre></td></tr><tr><td data-num="15"></td><td><pre>        prev<span class="token punctuation">,</span> curr <span class="token operator">=</span> curr<span class="token punctuation">,</span> next_value <span class="token comment">-- 更新状态变量</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">return</span> count<span class="token punctuation">,</span> prev <span class="token comment">-- 返回当前的索引和斐波那契数</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> iter <span class="token comment">-- 返回迭代器函数</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">for</span> index<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token function">fibonacci_iterator</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><h2 id="元表和元方法"><a class="anchor" href="#元表和元方法">#</a> 元表和元方法</h2><ul><li>元表（metatable）用于自定义 table 的行为</li><li>注意：元表不会继承</li><li>算术操作<ul><li>__add：定义加法 +</li><li>__sub：定义减法 -</li><li>__mul：定义乘法 *</li><li>__div：定义除法 /</li><li>__mod：定义取模 %</li><li>__pow：定义幂运算 ^</li></ul></li><li>比较操作<ul><li>__eq：定义相等 ==</li><li>__lt：定义小于 &lt;</li><li>__le：定义小于等于 &lt;=</li></ul></li><li>索引操作<ul><li>__index：当访问 table 中不存在的字段时调用</li><li>__newindex：当给 table 中不存在的字段赋值时调用</li></ul></li><li>其他操作<ul><li>__call：让 table 像函数一样被调用</li><li>__tostring：自定义 tostring 函数的输出</li><li>__metatable：保护元表，不允许外部修改或查看</li></ul></li><li>相关函数<ul><li>setmetatable (,)：将元表绑定到目标 table</li><li>getmetatable ()：获取目标 table 的元表</li></ul></li><li>Lua 查找一个表元素的规则<ol><li>在表中查找，如果找到，返回该元素，找不到则继续</li><li>判断该表是否有元表，如果没有元表，返回 nil，有元表则继续</li><li>判断元表有没有 __index 方法<br>如果 __index 方法为 nil，则返回 nil<br>如果 __index 方法是一个表，则重复 1、2、3<br>如果 __index 方法是一个函数，则返回该函数的返回值</li></ol></li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 算术操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">-- 定义目标 table</span></pre></td></tr><tr><td data-num="3"></td><td><pre>t1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>t2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">-- 定义元表</span></pre></td></tr><tr><td data-num="7"></td><td><pre>mt <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    __add <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">-- 设置元表到目标 table</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">setmetatable</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> mt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">setmetatable</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> mt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">-- 使用自定义的加法操作</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>t1 <span class="token operator">+</span> t2<span class="token punctuation">)</span> <span class="token comment">-- 输出: 4</span></pre></td></tr></table></figure><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 比较操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>t1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    value <span class="token operator">=</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>t2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    value <span class="token operator">=</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>mt <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    __lt <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">return</span> a<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>value</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token function">setmetatable</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> mt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token function">setmetatable</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> mt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>t1 <span class="token operator">&lt;</span> t2<span class="token punctuation">)</span> <span class="token comment">-- 输出: true</span></pre></td></tr></table></figure><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 索引操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>t <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 定义元表</span></pre></td></tr><tr><td data-num="5"></td><td><pre>mt <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    __index <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>tbl<span class="token punctuation">,</span> key<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"默认值"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">end</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    __newindex <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>tbl<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"正在设置新的键值对:"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token function">rawset</span><span class="token punctuation">(</span>tbl<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token comment">-- 手动设置值</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">setmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> mt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>someKey<span class="token punctuation">)</span> <span class="token comment">-- 输出：默认值</span></pre></td></tr><tr><td data-num="18"></td><td><pre>t<span class="token punctuation">.</span>someKey <span class="token operator">=</span> <span class="token string">"新值"</span> <span class="token comment">-- 输出：正在设置新的键值对: someKey 新值</span></pre></td></tr></table></figure><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 其他操作</span></pre></td></tr><tr><td data-num="2"></td><td><pre>t <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>mt <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    __call <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>tbl<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"被当作函数调用"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">end</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    __tostring <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>tbl<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"这是一个自定义的 table"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">setmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> mt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token comment">-- 输出：这是一个自定义的 table</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出：被当作函数调用</span></pre></td></tr></table></figure><h1 id="模块"><a class="anchor" href="#模块">#</a> 模块</h1><p>模块类似于一个封装库，把一些公用的代码放在一个文件里，以 API 接口的形式在其他地方调用，有利于代码的重用和降低代码耦合度。</p><p>Lua 的模块是由变量、函数等已知元素组成的 table</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- mod.lua 文件中的代码</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mod <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>mod<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">function</span> mod<span class="token punctuation">.</span><span class="token function">fun_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"public function"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">func_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"private function"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">function</span> mod<span class="token punctuation">.</span><span class="token function">func_3</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">func_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">return</span> mod</pre></td></tr></table></figure><p>使用 <code>require(&quot;name&quot;)</code> 或 <code>require &quot;name&quot;</code> 加载模块</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"mod"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mod<span class="token punctuation">.</span><span class="token function">fun_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>mod<span class="token punctuation">.</span><span class="token function">func_3</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>m <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"mod"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>m<span class="token punctuation">.</span><span class="token function">fun_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>m<span class="token punctuation">.</span><span class="token function">func_3</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>加载机制</p><ul><li>Lua 首先会检查全局表 package.loaded，该表存储了所有已加载的模块</li><li>如果模块未加载，Lua 会根据 package.path（Lua 文件路径）和 package.cpath（C 程序库）搜索模块文件</li><li>根据文件后缀，Lua 调用不同的加载器<ul><li>.lua 文件：通过 loadfile () 加载并执行</li><li>.so 或 .dll 文件：通过动态链接库加载</li></ul></li><li>加载完成后，Lua 会将模块的返回值保存到 package.loaded 中，并返回给调用者</li></ul><p>临时修改路径</p><ul><li>通过代码对 package.path 的修改是临时的，只在当前 Lua 程序的运行期间有效</li><li><code>package.path = package.path .. &quot;;.\\my_modules\\?.lua&quot;</code><ul><li><code>;</code> 用于分割多个路径</li><li><code>.\\my_modules\\?.lua</code> 是新增路径</li><li><code>?</code> 是占位符，也就是 <code>require(&quot;name&quot;)</code> 中的 <code>name</code></li></ul></li></ul><p>永久更改路径</p><ul><li>Windows 在系统环境变量中设置<br>新增一个环境变量 LUA_PATH，值为 <code>.\\my_modules\\?.lua;;</code><ul><li><code>;;</code> 表示新加的路径后面加上原来的默认路径</li></ul></li><li>Linux/macOS 在 .bashrc 或 .zshrc 中设置<br><code>export LUA_PATH=&quot;./my_modules/?.lua;;&quot;</code></li></ul><h1 id="c-包"><a class="anchor" href="#c-包">#</a> C 包</h1><ul><li>C 包在使用以前必须首先加载并连接，在大多数系统中最容易的实现方式是通过动态连接库机制</li><li>Lua 在 package.loadlib 函数内提供了所有的动态连接的功能<ul><li>这个函数有两个参数：库的绝对路径 和 初始化函数</li></ul></li><li>一般情况下，将需要的库归类存放，创建一个 .lua 文件存放索引，然后将文件所在的目录加入到 LUA_PATH</li></ul><p>创建 C 包流程</p><ol><li>在 Visual Studio 中创建空项目，将配置类型改为动态库 (.dll)</li><li>导入所有 lua 源码（除了 lua.c、luac.c、Makefile）</li><li>新建 .cpp 代码</li></ol><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"lua.hpp"</span> <span class="token comment">// Lua 头文件</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 一个简单的加法函数</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">lua_add</span><span class="token punctuation">(</span>lua_State<span class="token operator">*</span> L<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token function">luaL_checkinteger</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token function">luaL_checkinteger</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">lua_pushinteger</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 返回结果数量</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// 函数注册表</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">const</span> luaL_Reg mylib<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token string">"add"</span><span class="token punctuation">,</span> lua_add<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// 注册函数</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">&#125;</span>      <span class="token comment">// 结束标记</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">// 模块初始化函数</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">//luaopen_mylib 就是 初始化函数</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">// 命名规则 luaopen_XXX 其中 XXX 就是 .dll 文件的文件名（或者在生成 .dll 文件后，将 .dll 文件的名称改为 XXX）</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token function">__declspec</span><span class="token punctuation">(</span>dllexport<span class="token punctuation">)</span> <span class="token keyword">int</span> <span class="token function">luaopen_mylib</span><span class="token punctuation">(</span>lua_State<span class="token operator">*</span> L<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">luaL_newlib</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> mylib<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建模块表</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 返回模块表</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="4"><li>生成项目，然后在 Debug 或 Release 文件夹中找到生成的 .dll 文件。将它复制到 你觉得合适的位置（例如：lua 源文件目录）</li><li>在 Lua 中编写代码调用</li></ol><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 我把 .dll 文件放到了 lua 源文件目录，所以可以直接这样写</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">-- 否则，必须写出文件的完整路径</span></pre></td></tr><tr><td data-num="3"></td><td><pre>path <span class="token operator">=</span> <span class="token string">"mylib.dll"</span> </pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">-- 初始化函数，必须与 cpp 代码中的初始化函数 相同</span></pre></td></tr><tr><td data-num="6"></td><td><pre>init <span class="token operator">=</span> <span class="token string">"luaopen_mylib"</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>mylib <span class="token operator">=</span> package<span class="token punctuation">.</span><span class="token function">loadlib</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> init<span class="token punctuation">)</span> <span class="token comment">-- 链接库</span></pre></td></tr><tr><td data-num="9"></td><td><pre>mylib <span class="token operator">=</span> <span class="token function">mylib</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- 打开库</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">-- 检查是否加载成功</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">if</span> <span class="token keyword">not</span> mylib <span class="token keyword">then</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Failed to load DLL: "</span> <span class="token operator">..</span> <span class="token punctuation">(</span>err <span class="token keyword">or</span> <span class="token string">"unknown error"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">-- 调用导出函数</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>mylib<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="协同程序"><a class="anchor" href="#协同程序">#</a> 协同程序</h1><p>Lua 协同程序（Coroutine）是 Lua 中的一种轻量级线程机制，它允许以非抢占式多任务的方式实现并发。协同程序在 Lua 中被认为是线程的一个子集，它更接近于一种函数的挂起和恢复机制<br>Lua 协同程序拥有独立的堆栈，独立的局部变量，独立的指令指针</p><p>协同程序由 coroutine 模块提供支持</p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>coroutine.create()</td><td>创建 coroutine，返回 coroutine， 参数是一个函数，当和 resume 配合使用的时候就唤醒函数调用</td></tr><tr><td>coroutine.resume()</td><td>重启 coroutine，和 create 配合使用。第一个返回值：布尔值，表示协同程序是否成功恢复。后续返回值：协同程序挂起时通过 coroutine.yield () 返回的值</td></tr><tr><td>coroutine.yield()</td><td>挂起 coroutine</td></tr><tr><td>coroutine.status()</td><td>查看 coroutine 的状态，有三种：dead，suspended，running</td></tr><tr><td>coroutine.wrap()</td><td>创建 coroutine，返回一个函数，该函数在调用时会直接运行协同程序</td></tr><tr><td>coroutine.running()</td><td>返回正在运行的 coroutine，一个 coroutine 就是一个线程，当使用 running 的时候，就是返回一个 coroutine 的线程号</td></tr></tbody></table><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 定义协同程序</span></pre></td></tr><tr><td data-num="2"></td><td><pre>co <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Coroutine running: "</span> <span class="token operator">..</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        coroutine<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- 挂起协同程序</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">end</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">-- 恢复协同程序</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>coroutine<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- suspended</span></pre></td></tr><tr><td data-num="11"></td><td><pre>coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span> <span class="token comment">-- 输出 Coroutine running: 1</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>coroutine<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- suspended</span></pre></td></tr><tr><td data-num="13"></td><td><pre>coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span> <span class="token comment">-- 输出 Coroutine running: 2</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>coroutine<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- suspended</span></pre></td></tr><tr><td data-num="15"></td><td><pre>coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span> <span class="token comment">-- 输出 Coroutine running: 3</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>coroutine<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- dead</span></pre></td></tr></table></figure><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 生产者 - 消费者问题</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">function</span> <span class="token function">producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> coroutine<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Producing: "</span> <span class="token operator">..</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            coroutine<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">-- 将值返回给消费者</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">end</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">function</span> <span class="token function">consumer</span><span class="token punctuation">(</span>prod<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">local</span> status <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">local</span> value</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">while</span> <span class="token keyword">true</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token comment">-- 获取生产者的值</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        status<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>prod<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        status<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>prod<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token comment">-- 如果协同程序结束</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">not</span> status<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">or</span> status<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"dead"</span><span class="token punctuation">)</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Consuming: "</span> <span class="token operator">..</span> value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">-- 测试</span></pre></td></tr><tr><td data-num="29"></td><td><pre>p <span class="token operator">=</span> <span class="token function">producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token function">consumer</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span></pre></td></tr></table></figure><p>线程和协同程序区别</p><table><thead><tr><th>特性</th><th>Lua 线程</th><th>Lua 协同程序</th></tr></thead><tbody><tr><td>创建方式</td><td>使用 Lua C API 创建</td><td>使用 <code>coroutine.create</code> 创建</td></tr><tr><td>底层依赖</td><td>操作系统的多线程机制</td><td>纯 Lua 实现，运行在单线程环境中</td></tr><tr><td>并行能力</td><td>支持多核并行</td><td>不支持并行，只能切换执行权</td></tr><tr><td>切换方式</td><td>操作系统调度</td><td>显式调用 <code>coroutine.resume</code> / <code>yield</code></td></tr><tr><td>开销</td><td>高（需要操作系统资源）</td><td>低（轻量级，纯 Lua 实现）</td></tr><tr><td>适用场景</td><td>复杂的多任务或计算密集型场景</td><td>游戏开发、简单的状态管理和异步任务</td></tr><tr><td>线程隔离性</td><td>独立的 Lua 堆栈和环境</td><td>共享同一个 Lua 环境</td></tr></tbody></table><h1 id="io"><a class="anchor" href="#io">#</a> I/O</h1><p>操作文件的语句： <code>file = io.open (filename [, mode])</code></p><table><thead><tr><th>mode</th><th>描述</th></tr></thead><tbody><tr><td>r</td><td>只读。文件必须存在</td></tr><tr><td>w</td><td>只写。若文件存在则清空文件内容，若文件不存在则新建文件</td></tr><tr><td>a</td><td>以附加的方式打开只写文件。若文件存在，写入的数据会被加到文件尾，若文件不存在则新建文件</td></tr><tr><td>r+</td><td>在 r 的基础上增加 写</td></tr><tr><td>w+</td><td>在 w 的基础上增加 读</td></tr><tr><td>a+</td><td>在 a 的基础上增加 读</td></tr><tr><td>b</td><td>二进制模式，用于二进制文件</td></tr></tbody></table><p>全局模式 <code>io.function</code></p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td><code>io.open</code></td><td>打开并返回一个文件句柄</td></tr><tr><td><code>io.input</code></td><td>获取或设置当前默认输入文件</td></tr><tr><td><code>io.output</code></td><td>获取或设置当前默认输出文件</td></tr><tr><td><code>io.read</code></td><td>从默认输入文件读取内容</td></tr><tr><td><code>io.write</code></td><td>写入内容到默认输出文件</td></tr><tr><td><code>io.flush</code></td><td>刷新默认输出文件的缓冲区</td></tr><tr><td><code>io.close</code></td><td>关闭默认文件（输入或输出）</td></tr><tr><td><code>io.popen</code></td><td>执行系统命令（获取命令的输出或与其交互）</td></tr></tbody></table><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 以附加的方式打开文件</span></pre></td></tr><tr><td data-num="2"></td><td><pre>file <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"test.lua"</span><span class="token punctuation">,</span> <span class="token string">"a+"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 设置默认输入文件为 test.lua</span></pre></td></tr><tr><td data-num="5"></td><td><pre>io<span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">-- 输出文件第一行</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">-- 关闭打开的文件</span></pre></td></tr><tr><td data-num="11"></td><td><pre>io<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">-- 写入到 test.lua</span></pre></td></tr><tr><td data-num="14"></td><td><pre>file <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"test.lua"</span><span class="token punctuation">,</span> <span class="token string">"a+"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>io<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"--Hello, Lua!"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>io<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- 刷新缓冲区</span></pre></td></tr></table></figure><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- io.popen 执行系统命令并读取输出</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">-- "r": 读取命令的输出（默认）</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">-- "w": 向命令输入数据</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">local</span> handle <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">popen</span><span class="token punctuation">(</span><span class="token string">"ls -l"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">if</span> handle <span class="token keyword">then</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">local</span> result <span class="token operator">=</span> handle<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"*a"</span><span class="token punctuation">)</span> <span class="token comment">-- 读取所有输出</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    handle<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">else</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Failed to execute command"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><p>句柄模式 <code>file:function</code></p><ul><li>通过文件句柄操作文件</li><li>每个文件句柄是独立的，适合同时操作多个文件</li><li>不依赖全局的默认输入或输出文件</li></ul><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td><code>file:read</code></td><td>按指定模式从文件中读取内容</td></tr><tr><td><code>file:write</code></td><td>写入内容到文件</td></tr><tr><td><code>file:lines</code></td><td>返回一个迭代器，用于逐行读取文件内容</td></tr><tr><td><code>file:flush</code></td><td>刷新文件的缓冲区</td></tr><tr><td><code>file:seek</code></td><td>设置或获取文件指针的位置</td></tr><tr><td><code>file:close</code></td><td>关闭文件</td></tr></tbody></table><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 打开文件以写入</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">local</span> file <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"test.lua"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>file<span class="token punctuation">:</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"--Hello, Lua!"</span><span class="token punctuation">)</span> <span class="token comment">-- 写入内容</span></pre></td></tr><tr><td data-num="4"></td><td><pre>file<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- 关闭文件</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">-- 打开文件以读取</span></pre></td></tr><tr><td data-num="7"></td><td><pre>file <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"test.lua"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">local</span> content <span class="token operator">=</span> file<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"*all"</span><span class="token punctuation">)</span> <span class="token comment">-- 读取整个文件</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token comment">-- 输出: Hello, Lua!</span></pre></td></tr><tr><td data-num="10"></td><td><pre>file<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- 关闭文件</span></pre></td></tr></table></figure><p>二者的主要区别</p><table><thead><tr><th>特性</th><th><code>io.function</code> 全局模式</th><th><code>file:function</code> 句柄模式</th></tr></thead><tbody><tr><td>适用范围</td><td>作用于全局的默认文件</td><td>作用于特定的文件句柄</td></tr><tr><td>多文件操作</td><td>只能同时操作一个默认文件</td><td>可以同时操作多个文件</td></tr><tr><td>灵活性</td><td>较低，需要频繁更改默认文件</td><td>更高，操作独立文件句柄</td></tr><tr><td>效率</td><td>较低，因为频繁更改默认文件影响效率</td><td>较高，专注于特定文件操作</td></tr><tr><td>函数接口</td><td>与全局输入 / 输出文件交互的函数</td><td>文件句柄的成员函数</td></tr></tbody></table><p>其他常用操作</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 删除文件</span></pre></td></tr><tr><td data-num="2"></td><td><pre>os<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 执行系统命令（只能检查是否成功，无法交互）</span></pre></td></tr><tr><td data-num="5"></td><td><pre>os<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"mkdir my_folder"</span><span class="token punctuation">)</span> <span class="token comment">-- 创建文件夹</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">if</span> result <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span>  <span class="token comment">-- 检查是否成功</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"File deleted successfully"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">else</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Failed to delete file"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 复制文件（手动复制）</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">copyFile</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dest<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">local</span> srcFile <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token comment">-- 以二进制模式读取</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> srcFile <span class="token keyword">then</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"无法打开源文件："</span> <span class="token operator">..</span> src<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">false</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">local</span> destFile <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token comment">-- 以二进制模式写入</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> destFile <span class="token keyword">then</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"无法创建目标文件："</span> <span class="token operator">..</span> dest<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        srcFile<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">false</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    destFile<span class="token punctuation">:</span><span class="token function">write</span><span class="token punctuation">(</span>srcFile<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"*a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 读取整个文件并写入</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    srcFile<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    destFile<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"文件复制成功："</span> <span class="token operator">..</span> src <span class="token operator">..</span> <span class="token string">" → "</span> <span class="token operator">..</span> dest<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">true</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token function">copyFile</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"backup\\test.txt"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">-- 复制文件（系统命令）</span></pre></td></tr><tr><td data-num="26"></td><td><pre>os<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">'copy "example.txt" "backup\\example.txt"'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="面向对象"><a class="anchor" href="#面向对象">#</a> 面向对象</h1><ul><li>对象由属性和方法组成，在 lua 中使用 table 和 function 模拟出来</li><li>可以使用 metetable 实现继承</li><li>将 lua 中的一个 table 看做一个类，基于这个 table 声明变量和函数，即可实现一个类的模拟</li><li>命名规则：类中使用 <code>:</code> 定义和访问函数，使用 <code>.</code> 访问变量</li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- Class.lua 中的代码</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Class <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">-- 类</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Class<span class="token punctuation">.</span>__index <span class="token operator">=</span> Class <span class="token comment">-- 设置索引元方法</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>Class<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">10</span> <span class="token comment">-- 公共变量</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">local</span> a <span class="token operator">=</span> <span class="token number">20</span> <span class="token comment">-- 私有变量</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">function</span> Class<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">local</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">setmetatable</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> Class<span class="token punctuation">)</span> <span class="token comment">-- 设置元表，使对象继承类的方法</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> obj</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">function</span> Class<span class="token punctuation">:</span><span class="token function">fun_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"public function"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">func_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"private function"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">function</span> Class<span class="token punctuation">:</span><span class="token function">func_3</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token function">func_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"Class"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">local</span> obj <span class="token operator">=</span> Class<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>obj<span class="token punctuation">:</span><span class="token function">fun_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>obj<span class="token punctuation">:</span><span class="token function">func_3</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>封装、继承、多态</p><ul><li>继承：设置子类的元表</li><li>方法重写：在子类中以相同的名称重新定义方法</li><li>变量 <code>self</code> ： <code>Class:new()</code> 中 <code>self</code> 就是 <code>Class</code></li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 父类</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Class <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Class<span class="token punctuation">.</span>__index <span class="token operator">=</span> Class</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>Class<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">function</span> Class<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">local</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">setmetatable</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> self<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"name"</span> <span class="token comment">-- 封装</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> obj</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">function</span> Class<span class="token punctuation">:</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Class:func()"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">function</span> Class<span class="token punctuation">:</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">-- 子类</span></pre></td></tr><tr><td data-num="23"></td><td><pre>SubClass_1 <span class="token operator">=</span> Class<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>SubClass_1<span class="token punctuation">.</span>__index <span class="token operator">=</span> SubClass_1</pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>SubClass_1<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">20</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">function</span> SubClass_1<span class="token punctuation">:</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- 重写</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"SubClass_1:func()"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">-- 子类</span></pre></td></tr><tr><td data-num="33"></td><td><pre>SubClass_2 <span class="token operator">=</span> Class<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>SubClass_2<span class="token punctuation">.</span>__index <span class="token operator">=</span> SubClass_2</pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">function</span> SubClass_2<span class="token punctuation">:</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- 重写</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"SubClass_2:func()"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment">-- 创建子类的对象</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">local</span> obj_1 <span class="token operator">=</span> SubClass_1<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>obj_1<span class="token punctuation">:</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"SubClass_1"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>obj_1<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token keyword">local</span> obj_2 <span class="token operator">=</span> SubClass_2<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>obj_2<span class="token punctuation">:</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"SubClass_2"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>obj_2<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token comment">-- 多态</span></pre></td></tr><tr><td data-num="50"></td><td><pre>obj_1<span class="token punctuation">:</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>obj_2<span class="token punctuation">:</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="事件"><a class="anchor" href="#事件">#</a> 事件</h1><p>使用 table 实现事件系统</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 定义一个简单的事件管理器</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">local</span> EventManager <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    events <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">function</span> EventManager<span class="token punctuation">:</span><span class="token function">subscribe</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> callback<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        self<span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">function</span> EventManager<span class="token punctuation">:</span><span class="token function">trigger</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">if</span> self<span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">for</span> _<span class="token punctuation">,</span> callback <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">-- 使用事件管理器</span></pre></td></tr><tr><td data-num="22"></td><td><pre>EventManager<span class="token punctuation">:</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">"player_jump"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>name <span class="token operator">..</span> <span class="token string">" 跳跃了！"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">end</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">-- 触发事件</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">local</span> player <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    name <span class="token operator">=</span> <span class="token string">"玩家1"</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>EventManager<span class="token punctuation">:</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">"player_jump"</span><span class="token punctuation">,</span> player<span class="token punctuation">)</span></pre></td></tr></table></figure><p>模拟一个按钮对象</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">create_button</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">local</span> button <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>          <span class="token comment">-- 用来模拟对象的表</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">local</span> event_listeners <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">-- 用来存储事件监听器的表</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">local</span> is_enabled <span class="token operator">=</span> <span class="token keyword">true</span>    <span class="token comment">-- 按钮是否可用</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">-- 方法：设置按钮标签</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">function</span> button<span class="token punctuation">:</span><span class="token function">set_label</span><span class="token punctuation">(</span>new_label<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        label <span class="token operator">=</span> new_label</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">-- 方法：获取按钮标签</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">function</span> button<span class="token punctuation">:</span><span class="token function">get_label</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> label</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">-- 方法：设置按钮状态</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">function</span> button<span class="token punctuation">:</span><span class="token function">set_enabled</span><span class="token punctuation">(</span>enabled<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        is_enabled <span class="token operator">=</span> enabled</pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">-- 方法：获取按钮状态</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">function</span> button<span class="token punctuation">:</span><span class="token function">is_enabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">return</span> is_enabled</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">-- 方法：注册事件监听器</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">function</span> button<span class="token punctuation">:</span><span class="token function">on</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> listener<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> event_listeners<span class="token punctuation">[</span>event_name<span class="token punctuation">]</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            event_listeners<span class="token punctuation">[</span>event_name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>event_listeners<span class="token punctuation">[</span>event_name<span class="token punctuation">]</span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token comment">-- 方法：触发事件</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">function</span> button<span class="token punctuation">:</span><span class="token function">trigger</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> is_enabled <span class="token keyword">then</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Button is disabled"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token keyword">return</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">local</span> listeners <span class="token operator">=</span> event_listeners<span class="token punctuation">[</span>event_name<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">if</span> listeners <span class="token keyword">then</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token keyword">for</span> _<span class="token punctuation">,</span> listener <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>listeners<span class="token punctuation">)</span> <span class="token keyword">do</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">)</span> <span class="token comment">-- 调用回调函数</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token keyword">end</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token keyword">end</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">return</span> button</pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token comment">-- 创建按钮对象</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token keyword">local</span> button <span class="token operator">=</span> <span class="token function">create_button</span><span class="token punctuation">(</span><span class="token string">"Submit"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token comment">-- 注册事件监听器</span></pre></td></tr><tr><td data-num="55"></td><td><pre>button<span class="token punctuation">:</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Button was clicked!"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token keyword">end</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre>button<span class="token punctuation">:</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Another listener for the same click event."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token keyword">end</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre>button<span class="token punctuation">:</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"hover"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Button is hovered."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token keyword">end</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="66"></td><td><pre></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token comment">-- 模拟事件触发</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Initial label:"</span><span class="token punctuation">,</span> button<span class="token punctuation">:</span><span class="token function">get_label</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出 Submit</span></pre></td></tr><tr><td data-num="69"></td><td><pre>button<span class="token punctuation">:</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">)</span>                     <span class="token comment">-- 触发 click 事件</span></pre></td></tr><tr><td data-num="70"></td><td><pre>button<span class="token punctuation">:</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">"hover"</span><span class="token punctuation">)</span>                     <span class="token comment">-- 触发 hover 事件</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token comment">-- 更新按钮标签和状态</span></pre></td></tr><tr><td data-num="73"></td><td><pre>button<span class="token punctuation">:</span><span class="token function">set_label</span><span class="token punctuation">(</span><span class="token string">"Send"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>button<span class="token punctuation">:</span><span class="token function">set_enabled</span><span class="token punctuation">(</span><span class="token keyword">false</span><span class="token punctuation">)</span> <span class="token comment">-- 禁用按钮</span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Updated label:"</span><span class="token punctuation">,</span> button<span class="token punctuation">:</span><span class="token function">get_label</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出 Send</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token comment">-- 再次触发事件（按钮被禁用，事件不执行）</span></pre></td></tr><tr><td data-num="78"></td><td><pre>button<span class="token punctuation">:</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">)</span> <span class="token comment">-- 输出 Button is disabled</span></pre></td></tr></table></figure><h1 id="错误处理"><a class="anchor" href="#错误处理">#</a> 错误处理</h1><ul><li>错误捕获：通过 pcall 和 xpcall 捕获错误</li><li>错误抛出：通过 error 和 assert 抛出自定义错误</li><li>调试信息：通过 debug.traceback 获取错误发生时的调用栈信息</li></ul><p>错误捕获 <code>pcall(function, ...)</code></p><ul><li>第一个值为布尔值，true 表示成功，false 表示发生错误</li><li>后续值为函数的返回值或错误信息</li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">/</span> b</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>status<span class="token punctuation">,</span> result <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>divide<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">nil</span><span class="token punctuation">)</span> <span class="token comment">-- 安全调用</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">if</span> status <span class="token keyword">then</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Result:"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">else</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Error:"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token comment">-- 输出错误信息</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><p>错误捕获 <code>xpcall(function, errorHandler)</code></p><ul><li>与 pcall 类似，但允许提供一个错误处理函数，用于处理错误信息</li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">/</span> b</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">function</span> <span class="token function">errorHandler</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">"Caught error: "</span> <span class="token operator">..</span> error</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>status<span class="token punctuation">,</span> result <span class="token operator">=</span> <span class="token function">xpcall</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">nil</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">end</span><span class="token punctuation">,</span> errorHandler<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">if</span> status <span class="token keyword">then</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Result:"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">else</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">end</span></pre></td></tr></table></figure><p>抛出错误 <code>error(message, level)</code></p><ul><li>message：错误信息</li><li>level：堆栈级别<ul><li>0 不添加错误位置信息</li><li>1 默认，指出错误位置（文件 + 行号）</li><li>2 二层堆栈</li></ul></li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">checkValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> value <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Value must be non-negative!"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- 抛出错误，2 表示上两层堆栈</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> value</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">checkValue</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">-- 运行到这里会报错</span></pre></td></tr></table></figure><p>抛出错误 <code>assert(condition, message)</code></p><ul><li>简化错误抛出</li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">assert</span><span class="token punctuation">(</span>b <span class="token operator">~=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Division by zero!"</span><span class="token punctuation">)</span> <span class="token comment">-- 条件不满足时抛出错误</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">/</span> b</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出: 5</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 运行到这里会报错</span></pre></td></tr></table></figure><p>调试信息 <code>debug.traceback(message, level)</code></p><ul><li>提供错误发生时的调用栈信息</li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">level1</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"An error occurred!"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">function</span> <span class="token function">level2</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">level1</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    status<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>level2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> status <span class="token keyword">then</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token function">print</span><span class="token punctuation">(</span>debug<span class="token punctuation">.</span><span class="token function">traceback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出调用栈信息</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="debug"><a class="anchor" href="#debug">#</a> Debug</h1><table><thead><tr><th>方法</th><th>功能描述</th></tr></thead><tbody><tr><td><code>debug.traceback(message, level)</code></td><td>返回调用栈信息。 <code>message</code> 是前缀错误信息， <code>level</code> 指定从第几层堆栈开始</td></tr><tr><td><code>debug.getinfo(thread, func or level, [what])</code></td><td>获取函数或调用栈的元信息。 <code>what</code> 是可选参数，指定返回哪些信息，在表格下方有更多解释</td></tr><tr><td><code>debug.getlocal(thread, level, local_index)</code></td><td>获取指定调用栈层级的局部变量。 <code>local_index</code> 是变量的索引（从 1 开始）</td></tr><tr><td><code>debug.setlocal(thread, level, local_index, value)</code></td><td>修改指定调用栈层级的局部变量值</td></tr><tr><td><code>debug.getupvalue(func, upvalue_index)</code></td><td>获取闭包的上值。 <code>upvalue_index</code> 是上值的索引（从 1 开始）</td></tr><tr><td><code>debug.setupvalue(func, upvalue_index, value)</code></td><td>修改闭包的上值</td></tr><tr><td><code>debug.upvalueid(func, upvalue_index)</code></td><td>获取闭包上值的唯一标识 ID，用于比较两个上值是否相同</td></tr><tr><td><code>debug.upvaluejoin(func1, upvalue_index1, func2, upvalue_index2)</code></td><td>将 <code>func1</code> 的上值与 <code>func2</code> 的上值绑定，两个函数共享同一个上值</td></tr><tr><td><code>debug.gethook([thread])</code></td><td>获取指定线程的调试钩子函数及其设置</td></tr><tr><td><code>debug.sethook([thread], hook, mask, [count])</code></td><td>设置调试钩子函数。 <code>mask</code> 可以是 &quot;c&quot;（函数调用）、&quot;r&quot;（函数返回）、&quot;l&quot;（每行代码）</td></tr><tr><td><code>debug.getmetatable(value)</code></td><td>获取指定对象的元表</td></tr><tr><td><code>debug.setmetatable(value, metatable)</code></td><td>设置指定对象的元表</td></tr><tr><td><code>debug.getregistry()</code></td><td>返回 Lua 的全局注册表，用于存储全局变量和内部状态</td></tr><tr><td><code>debug.debug()</code></td><td>启动一个简单的交互调试器</td></tr></tbody></table><p><code>debug.getinfo</code> 中的可选参数用来指定需要返回的函数信息的类型</p><ul><li>n：函数的名称及相关信息（如果有）。包括以下字段：<ul><li>name：函数名称（如果可以推断出来）</li><li>namewhat：函数名称的来源描述（如 &quot;global&quot;、&quot;local&quot;、&quot;method&quot; 或 &quot;&quot;）</li></ul></li><li>S：函数定义的来源信息。包括以下字段：<ul><li>source：定义函数的源码文件路径（以 @ 开头）或字符串（以 = 开头）</li><li>short_src：简短的源码路径（仅文件名）</li><li>linedefined：函数起始定义的行号</li><li>lastlinedefined：函数定义结束的行号</li><li>what：函数类型（如 &quot;Lua&quot; 表示 Lua 函数，&quot;C&quot; 表示 C 函数）</li></ul></li><li>l：当前函数调用时的行号<ul><li>currentline：当前执行的行号</li></ul></li><li>f：函数本身<ul><li>func：返回该函数的引用</li></ul></li><li>L：一个布尔值，表示函数中所有行的可执行代码是否存在（不常用）</li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 获取调用栈信息</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>debug<span class="token punctuation">.</span><span class="token function">traceback</span><span class="token punctuation">(</span><span class="token string">"debug:"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 获取函数信息</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>info <span class="token operator">=</span> debug<span class="token punctuation">.</span><span class="token function">getinfo</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token string">"nSl"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>short_src<span class="token punctuation">,</span> info<span class="token punctuation">.</span>linedefined<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">-- 获取并修改局部变量</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">local</span> a <span class="token operator">=</span> <span class="token number">10</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span>debug<span class="token punctuation">.</span><span class="token function">getlocal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出: a 10</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    debug<span class="token punctuation">.</span><span class="token function">setlocal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">-- 输出: 20</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">-- 设置调试钩子</span></pre></td></tr><tr><td data-num="22"></td><td><pre>debug<span class="token punctuation">.</span><span class="token function">sethook</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hook triggered:"</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">end</span><span class="token punctuation">,</span> <span class="token string">"crl"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="垃圾回收"><a class="anchor" href="#垃圾回收">#</a> 垃圾回收</h1><ul><li>Lua 采用了自动内存管理，不需要关心内存的分配和回收</li><li>Lua 运行了一个垃圾收集器来收集所有不可能再访问到的对象</li><li>收集器使用这两个数字来控制垃圾收集循环： 垃圾收集器间歇率 和 垃圾收集器步进倍率<ul><li>垃圾收集器间歇率：控制收集频率</li><li>垃圾收集器步进倍率：控制收集器运作速度相对于内存分配速度的倍率。增大这个值不仅会让收集器更加积极，还会增加每个增量步骤的长度。默认值是 200，这表示收集器以内存分配的 &quot;两倍&quot; 速度工作</li></ul></li></ul><p>垃圾回收器函数 <code>collectgarbage()</code></p><ul><li><code>collectgarbage(&quot;collect&quot;)</code> ：做一次完整的垃圾收集循环</li><li><code>collectgarbage(&quot;count&quot;)</code> ：以 K 字节数为单位返回 Lua 使用的总内存数。 这个值有小数部分，所以只需要乘上 1024 就能得到 Lua 使用的准确字节数（除非溢出）</li><li><code>collectgarbage(&quot;restart&quot;)</code> ：重启垃圾收集器的自动运行</li><li><code>collectgarbage(&quot;setpause&quot;)</code> ：将 arg 设为收集器的 间歇率。 返回 间歇率 的前一个值</li><li><code>collectgarbage(&quot;setstepmul&quot;)</code> ：返回 步进倍率 的前一个值</li><li><code>collectgarbage(&quot;step&quot;)</code> ：单步运行垃圾收集器。 步长 &quot;大小&quot; 由 arg 控制。 传入 0 时，收集器步进（不可分割的）一步。 传入非 0 值， 收集器收集相当于 Lua 分配这些多（K 字节）内存的工作。 如果收集器结束一个循环将返回 true</li><li><code>collectgarbage(&quot;stop&quot;)</code> ：停止垃圾收集器的运行。 在调用重启前，收集器只会因显式的调用运行</li></ul><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre>table <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"0"</span><span class="token punctuation">,</span> <span class="token string">"7"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">collectgarbage</span><span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>table <span class="token operator">=</span> <span class="token keyword">nil</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">collectgarbage</span><span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">collectgarbage</span><span class="token punctuation">(</span><span class="token string">"collect"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">collectgarbage</span><span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/Lua/" rel="tag"><i class="ic i-tag"></i> Lua</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2025-06-17 13:26:39" itemprop="dateModified" datetime="2025-06-17T13:26:39+08:00">2025-06-17</time> </span><span id="2025/01/20/Lua/Lua/" class="item leancloud_visitors" data-flag-title="Lua" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Maikire 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Maikire 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Maikire 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Maikire <i class="ic i-at"><em>@</em></i>forget-me-not</li><li class="link"><strong>本文链接：</strong> <a href="https://maikire.xyz/2025/01/20/Lua/Lua/" title="Lua">https://maikire.xyz/2025/01/20/Lua/Lua/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2025/01/10/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;img.z4a.net&#x2F;images&#x2F;2025&#x2F;07&#x2F;31&#x2F;88b39e07ea05c813c7918412dc6686ad8506bf8e_raw.jpeg" title="正则表达式"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 正则表达式</span><h3>正则表达式</h3></a></div><div class="item right"><a href="/2025/02/12/Lua/Lua%20+%20CSharp/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;img.z4a.net&#x2F;images&#x2F;2025&#x2F;08&#x2F;01&#x2F;1597328139997.jpeg" title="Lua + CSharp"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Lua</span><h3>Lua + CSharp</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#lua"><span class="toc-number">1.</span> <span class="toc-text">Lua</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">2.1.</span> <span class="toc-text">注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E8%AF%86%E7%AC%A6"><span class="toc-number">2.2.</span> <span class="toc-text">标识符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.3.</span> <span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">2.4.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E5%92%8C%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.5.</span> <span class="toc-text">循环和条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.6.</span> <span class="toc-text">运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.7.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#table"><span class="toc-number">2.8.</span> <span class="toc-text">table</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">2.9.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AD%E5%8C%85"><span class="toc-number">2.10.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">2.11.</span> <span class="toc-text">迭代器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E8%A1%A8%E5%92%8C%E5%85%83%E6%96%B9%E6%B3%95"><span class="toc-number">2.12.</span> <span class="toc-text">元表和元方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97"><span class="toc-number">3.</span> <span class="toc-text">模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#c-%E5%8C%85"><span class="toc-number">4.</span> <span class="toc-text">C 包</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%8F%E5%90%8C%E7%A8%8B%E5%BA%8F"><span class="toc-number">5.</span> <span class="toc-text">协同程序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#io"><span class="toc-number">6.</span> <span class="toc-text">I&#x2F;O</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.</span> <span class="toc-text">面向对象</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6"><span class="toc-number">8.</span> <span class="toc-text">事件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">9.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#debug"><span class="toc-number">10.</span> <span class="toc-text">Debug</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">11.</span> <span class="toc-text">垃圾回收</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/2025/01/20/Lua/Lua/" rel="bookmark" title="Lua">Lua</a></li><li><a href="/2025/02/12/Lua/Lua%20+%20CSharp/" rel="bookmark" title="Lua + CSharp">Lua + CSharp</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Maikire" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Maikire</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">75</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">21</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">15</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL21haWtpcmU=" title="https:&#x2F;&#x2F;github.com&#x2F;maikire"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTQyNTE2MzE4MA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;425163180"><i class="ic i-cloud-music"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMzgxNDY5ODQ5P3NwbV9pZF9mcm9tPTMzMy4xMDA3LjAuMA==" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;381469849?spm_id_from&#x3D;333.1007.0.0"><i class="ic i-bilibili"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmwyNTQxNzU4OTg5QGdtYWlsLmNvbQ==" title="mailto:l2541758989@gmail.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/games" rel="section"><i class="ic i-play"></i>游戏</a></li><li class="item"><a href="/friends" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><span class="exturl" data-url="aHR0cHM6Ly93d3cudHJhdmVsbGluZ3MuY24vZ28uaHRtbA=="><i class="ic i-paper-plane"></i>开往</span></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2025/01/10/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2025/02/12/Lua/Lua%20+%20CSharp/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/DesignPatterns/" title="分类于 DesignPatterns">DesignPatterns</a></div><span><a href="/2023/07/23/DesignPatterns/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" title="观察者模式">观察者模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="分类于 CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CSharpBasics/" title="分类于 CSharpBasics">CSharpBasics</a></div><span><a href="/2023/03/28/CSharp/CSharpBasics/%E6%9E%9A%E4%B8%BE%E5%99%A8%EF%BC%88Enumerator%EF%BC%89/" title="枚举器（Enumerator）">枚举器（Enumerator）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/DesignPatterns/" title="分类于 DesignPatterns">DesignPatterns</a></div><span><a href="/2023/07/21/DesignPatterns/%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F/" title="模板模式">模板模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Unity/" title="分类于 Unity">Unity</a> <i class="ic i-angle-right"></i> <a href="/categories/Unity/UnityToolClass/" title="分类于 UnityToolClass">UnityToolClass</a></div><span><a href="/2023/04/13/Unity/UnityToolClass/%E5%AF%B9%E8%B1%A1%E6%B1%A0/" title="对象池">对象池</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" title="分类于 配置文件">配置文件</a></div><span><a href="/2023/08/07/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/XML/" title="XML">XML</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Unity/" title="分类于 Unity">Unity</a> <i class="ic i-angle-right"></i> <a href="/categories/Unity/UnityGames/" title="分类于 UnityGames">UnityGames</a> <i class="ic i-angle-right"></i> <a href="/categories/Unity/UnityGames/Unity2DGames/" title="分类于 Unity2DGames">Unity2DGames</a></div><span><a href="/2023/06/13/Unity/UnityGames/Unity2DGames/%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E7%BD%91%E7%BB%9C%E8%81%8A%E5%A4%A9%E5%AE%A4/" title="制作一个简单的网络聊天室">制作一个简单的网络聊天室</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Unity/" title="分类于 Unity">Unity</a> <i class="ic i-angle-right"></i> <a href="/categories/Unity/UnityToolClass/" title="分类于 UnityToolClass">UnityToolClass</a></div><span><a href="/2023/04/13/Unity/UnityToolClass/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%99%A8/" title="资源管理器">资源管理器</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/DesignPatterns/" title="分类于 DesignPatterns">DesignPatterns</a></div><span><a href="/2023/07/31/DesignPatterns/%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F/" title="解释器模式">解释器模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/DesignPatterns/" title="分类于 DesignPatterns">DesignPatterns</a></div><span><a href="/2023/07/30/DesignPatterns/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" title="责任链模式">责任链模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/DesignPatterns/" title="分类于 DesignPatterns">DesignPatterns</a></div><span><a href="/2023/07/27/DesignPatterns/%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F/" title="备忘录模式">备忘录模式</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2023 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Maikire @ Starry Letter</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2025/01/20/Lua/Lua/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>